"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[698],{4698:(S,m,c)=>{c.r(m),c.d(m,{HomeComponent:()=>E});var r=c(5861),t=c(9127),i=c(3403),h=c(4525),p=c(8890),g=c(8645),f=c(2832),C=c(4825),y=c(9773),v=c(6814),u=c(9933);function D(s,d){if(1&s){const n=t.EpF();t.TgZ(0,"ion-item",4),t.NdJ("click",function(){const a=t.CHM(n).$implicit,l=t.oxw();return t.KtG(l.selectDevice(a))}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&s){const n=d.$implicit;t.xp6(2),t.Oqu(n.label)}}let M=(()=>{class s{constructor(n){this.modalCtrl=n,this.devices=[]}cancel(){return this.modalCtrl.dismiss(null,"cancel")}selectDevice(n){return this.modalCtrl.dismiss(n,"confirm")}ngOnInit(){}static#t=this.\u0275fac=function(e){return new(e||s)(t.Y36(i.IN))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-device-modal"]],inputs:{devices:"devices"},standalone:!0,features:[t._Bn([i.IN]),t.jDz],decls:13,vars:8,consts:[["slot","start"],["slot","end"],[3,"strong","click"],["class","device",3,"click",4,"ngFor","ngForOf"],[1,"device",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar"),t._UZ(2,"ion-buttons",0),t.TgZ(3,"ion-title"),t._uU(4),t.ALo(5,"transloco"),t.qZA(),t.TgZ(6,"ion-buttons",1)(7,"ion-button",2),t.NdJ("click",function(){return o.cancel()}),t._uU(8),t.ALo(9,"transloco"),t.qZA()()()(),t.TgZ(10,"ion-content")(11,"ion-list"),t.YNc(12,D,3,1,"ion-item",3),t.qZA()()),2&e&&(t.xp6(4),t.hij(" ",t.lcZ(5,4,"messages.switch_camera")," "),t.xp6(3),t.Q6J("strong",!0),t.xp6(1),t.hij(" ",t.lcZ(9,6,"commands.close")," "),t.xp6(4),t.Q6J("ngForOf",o.devices))},dependencies:[v.ez,v.sg,i.W2,i.Ie,i.Q$,i.q_,i.Gu,i.sr,i.YG,i.Sm,i.wd,u.Ot],styles:[".device[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}"]})}return s})(),I=(()=>{class s{constructor(n){this.modalCtrl=n,this.name="",this.guid=""}cancel(){return this.modalCtrl.dismiss(null,"cancel")}confirm(){return this.modalCtrl.dismiss(this.name,"confirm")}ngOnInit(){}static#t=this.\u0275fac=function(e){return new(e||s)(t.Y36(i.IN))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-machine-modal"]],inputs:{name:"name",guid:"guid"},standalone:!0,features:[t._Bn([i.IN]),t.jDz],decls:18,vars:9,consts:[["slot","start"],["slot","end"],[3,"strong","click"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar"),t._UZ(2,"ion-buttons",0),t.TgZ(3,"ion-title"),t._uU(4),t.ALo(5,"transloco"),t.qZA(),t.TgZ(6,"ion-buttons",1)(7,"ion-button",2),t.NdJ("click",function(){return o.confirm()}),t._uU(8),t.ALo(9,"transloco"),t.qZA()()()(),t.TgZ(10,"ion-content")(11,"ion-list")(12,"ion-item")(13,"ion-label"),t._uU(14),t.qZA()(),t.TgZ(15,"ion-item")(16,"ion-label"),t._uU(17),t.qZA()()()()),2&e&&(t.xp6(4),t.hij(" ",t.lcZ(5,5,"messages.machine_data")," "),t.xp6(3),t.Q6J("strong",!0),t.xp6(1),t.hij(" ",t.lcZ(9,7,"commands.close")," "),t.xp6(6),t.Oqu(o.name),t.xp6(3),t.Oqu(o.guid))},dependencies:[i.W2,i.Ie,i.Q$,i.q_,i.Gu,i.sr,i.YG,i.Sm,i.wd,u.Ot]})}return s})();var w=c(6401),x=c(5099);class T{constructor(){this.id=0,this.location="",this.device="",this.user="",this.time="",this.arrived="",this.values={}}}const b=["video"],A=["videoContainer"];let E=(()=>{class s{constructor(){this.modalCtrl=(0,t.f3M)(i.IN),this.menuService=(0,t.f3M)(w.h),this.historyService=(0,t.f3M)(x.q),this.stopSubscriptions=new g.x,this.lastKnownQRData=null,this.isModalOpen=!1,(0,h.a)({cameraReverseOutline:p.Mrf})}canDismiss(n,e){return(0,r.Z)(function*(){return"gesture"!==e})()}ngOnInit(){(function Z(s=0,d=f.z){return s<0&&(s=0),(0,C.H)(s,s,d)})(500).pipe((0,y.R)(this.stopSubscriptions)).subscribe(()=>{this.setVideoSize(),this.getImage()}),this.menuService.openDeviceModal.subscribe(()=>{this.openDeviceModal()})}ngAfterViewInit(){this.startCamera("")}setVideoSize(){if(!this.videoContainer||!this.video)return;const n=this.videoContainer.nativeElement.offsetWidth,e=this.videoContainer.nativeElement.offsetHeight,l=(n-this.video.nativeElement.offsetWidth)/2,Q=(e-this.video.nativeElement.offsetHeight)/2;return e>n?(this.video.nativeElement.style.height=e+"px",this.video.nativeElement.style.left=l+"px"):(this.video.nativeElement.style.width=n+"px",this.video.nativeElement.style.top=Q+"px"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(this.video.nativeElement.style.width="100%",void(this.video.nativeElement.style.left="0px")):void 0}getDevices(){return(0,r.Z)(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind)})()}startCamera(n){var e=this;return(0,r.Z)(function*(){if(navigator.mediaDevices.getUserMedia){const o=yield e.getDevices();console.log(o[0].label),navigator.mediaDevices.getUserMedia({video:{deviceId:n||o[0].deviceId}}).then(a=>{e.video.nativeElement.srcObject=a}).catch(function(a){console.log("Something went wrong!"),console.log(a)})}})()}getImage(){var n=this;return(0,r.Z)(function*(){if(!n.video)return;const e=document.createElement("canvas");e.width=n.video.nativeElement.clientWidth,e.height=n.video.nativeElement.clientHeight;let o=e.getContext("2d");if(o&&(o.drawImage(n.video.nativeElement,0,0,e.width,e.height),0!==e.width&&0!==e.height)){var a=o.getImageData(0,0,e.width,e.height),l=jsQR(a.data,a.width,a.height,{inversionAttempts:"dontInvert"});if(l&&l.data){if((l=JSON.parse(l.data)).guid===n.lastKnownQRData?.guid)return;n.lastKnownQRData=l,yield n.openModal()}}})()}openModal(){var n=this;return(0,r.Z)(function*(){const e=yield n.modalCtrl.create({component:I,componentProps:{name:n.lastKnownQRData?.name,guid:n.lastKnownQRData?.guid}});e.present(),n.historyService.add({...new T,values:n.lastKnownQRData||{}}),yield e.onWillDismiss(),n.lastKnownQRData=null})()}openDeviceModal(){var n=this;return(0,r.Z)(function*(){const e=yield n.modalCtrl.create({component:M,componentProps:{devices:yield n.getDevices()}});e.present();const{data:o}=yield e.onWillDismiss();o?.deviceId&&n.startCamera(o?.deviceId)})()}ngOnDestroy(){this.stopSubscriptions.next(!0)}static#t=this.\u0275fac=function(e){return new(e||s)};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-home"]],viewQuery:function(e,o){if(1&e&&(t.Gf(b,5),t.Gf(A,5)),2&e){let a;t.iGM(a=t.CRH())&&(o.video=a.first),t.iGM(a=t.CRH())&&(o.videoContainer=a.first)}},standalone:!0,features:[t._Bn([i.IN]),t.jDz],decls:6,vars:0,consts:[[1,"video-card"],["videoContainer",""],["autoPlay","true","playsInline","true","muted",""],["video",""],["content",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0,1),t._UZ(2,"video",2,3),t.qZA(),t._UZ(4,"ion-content",null,4))},dependencies:[i.W2],styles:[".video-card[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;overflow:hidden}.video-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute}#camera-button[_ngcontent-%COMP%]{position:fixed;top:1em;right:1em}"]})}return s})()}}]);