"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[270],{1270:(x,m,c)=>{c.r(m),c.d(m,{HomeComponent:()=>T});var l=c(5861),t=c(9127),i=c(3403),v=c(4525),h=c(8890),p=c(8645),g=c(2832),f=c(4825),M=c(9773),u=c(6814);function D(s,d){if(1&s){const n=t.EpF();t.TgZ(0,"ion-item",4),t.NdJ("click",function(){const a=t.CHM(n).$implicit,r=t.oxw();return t.KtG(r.selectDevice(a))}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA()()}if(2&s){const n=d.$implicit;t.xp6(2),t.Oqu(n.label)}}let Z=(()=>{class s{constructor(n){this.modalCtrl=n,this.devices=[]}cancel(){return this.modalCtrl.dismiss(null,"cancel")}selectDevice(n){return this.modalCtrl.dismiss(n,"confirm")}ngOnInit(){}static#t=this.\u0275fac=function(e){return new(e||s)(t.Y36(i.IN))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-device-modal"]],inputs:{devices:"devices"},standalone:!0,features:[t._Bn([i.IN]),t.jDz],decls:11,vars:2,consts:[["slot","start"],["slot","end"],[3,"strong","click"],["class","device",3,"click",4,"ngFor","ngForOf"],[1,"device",3,"click"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar"),t._UZ(2,"ion-buttons",0),t.TgZ(3,"ion-title"),t._uU(4,"Kamera v\xe1lt\xe1sa"),t.qZA(),t.TgZ(5,"ion-buttons",1)(6,"ion-button",2),t.NdJ("click",function(){return o.cancel()}),t._uU(7,"Bez\xe1r"),t.qZA()()()(),t.TgZ(8,"ion-content")(9,"ion-list"),t.YNc(10,D,3,1,"ion-item",3),t.qZA()()),2&e&&(t.xp6(6),t.Q6J("strong",!0),t.xp6(4),t.Q6J("ngForOf",o.devices))},dependencies:[u.ez,u.sg,i.W2,i.Ie,i.Q$,i.q_,i.Gu,i.sr,i.YG,i.Sm,i.wd],styles:[".device[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}"]})}return s})(),y=(()=>{class s{constructor(n){this.modalCtrl=n,this.name="",this.guid=""}cancel(){return this.modalCtrl.dismiss(null,"cancel")}confirm(){return this.modalCtrl.dismiss(this.name,"confirm")}ngOnInit(){}static#t=this.\u0275fac=function(e){return new(e||s)(t.Y36(i.IN))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-machine-modal"]],inputs:{name:"name",guid:"guid"},standalone:!0,features:[t._Bn([i.IN]),t.jDz],decls:16,vars:3,consts:[["slot","start"],["slot","end"],[3,"strong","click"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar"),t._UZ(2,"ion-buttons",0),t.TgZ(3,"ion-title"),t._uU(4,"G\xe9p Adatai"),t.qZA(),t.TgZ(5,"ion-buttons",1)(6,"ion-button",2),t.NdJ("click",function(){return o.confirm()}),t._uU(7,"Bez\xe1r"),t.qZA()()()(),t.TgZ(8,"ion-content")(9,"ion-list")(10,"ion-item")(11,"ion-label"),t._uU(12),t.qZA()(),t.TgZ(13,"ion-item")(14,"ion-label"),t._uU(15),t.qZA()()()()),2&e&&(t.xp6(6),t.Q6J("strong",!0),t.xp6(6),t.Oqu(o.name),t.xp6(3),t.Oqu(o.guid))},dependencies:[i.W2,i.Ie,i.Q$,i.q_,i.Gu,i.sr,i.YG,i.Sm,i.wd]})}return s})();var I=c(6401);const b=["video"],O=["videoContainer"];let T=(()=>{class s{constructor(){this.modalCtrl=(0,t.f3M)(i.IN),this.menuService=(0,t.f3M)(I.h),this.stopSubscriptions=new p.x,this.lastKnownQRData=null,this.isModalOpen=!1,(0,v.a)({cameraReverseOutline:h.Mrf})}canDismiss(n,e){return(0,l.Z)(function*(){return"gesture"!==e})()}ngOnInit(){(function C(s=0,d=g.z){return s<0&&(s=0),(0,f.H)(s,s,d)})(500).pipe((0,M.R)(this.stopSubscriptions)).subscribe(()=>{this.setVideoSize(),this.getImage()}),this.menuService.openDeviceModal.subscribe(()=>{this.openDeviceModal()})}ngAfterViewInit(){this.startCamera("")}setVideoSize(){if(!this.videoContainer||!this.video)return;const n=this.videoContainer.nativeElement.offsetWidth,e=this.videoContainer.nativeElement.offsetHeight,r=(n-this.video.nativeElement.offsetWidth)/2,w=(e-this.video.nativeElement.offsetHeight)/2;return e>n?(this.video.nativeElement.style.height=e+"px",this.video.nativeElement.style.left=r+"px"):(this.video.nativeElement.style.width=n+"px",this.video.nativeElement.style.top=w+"px"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(this.video.nativeElement.style.width="100%",void(this.video.nativeElement.style.left="0px")):void 0}getDevices(){return(0,l.Z)(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind)})()}startCamera(n){var e=this;return(0,l.Z)(function*(){if(navigator.mediaDevices.getUserMedia){const o=yield e.getDevices();console.log(o[0].label),navigator.mediaDevices.getUserMedia({video:{deviceId:n||o[0].deviceId}}).then(a=>{e.video.nativeElement.srcObject=a}).catch(function(a){console.log("Something went wrong!"),console.log(a)})}})()}getImage(){var n=this;return(0,l.Z)(function*(){if(!n.video)return;const e=document.createElement("canvas");e.width=n.video.nativeElement.clientWidth,e.height=n.video.nativeElement.clientHeight;let o=e.getContext("2d");if(o&&(o.drawImage(n.video.nativeElement,0,0,e.width,e.height),0!==e.width&&0!==e.height)){var a=o.getImageData(0,0,e.width,e.height),r=jsQR(a.data,a.width,a.height,{inversionAttempts:"dontInvert"});if(r&&r.data){if((r=JSON.parse(r.data)).guid===n.lastKnownQRData?.guid)return;n.lastKnownQRData=r,yield n.openModal()}}})()}openModal(){var n=this;return(0,l.Z)(function*(){const e=yield n.modalCtrl.create({component:y,componentProps:{name:n.lastKnownQRData?.name,guid:n.lastKnownQRData?.guid}});e.present(),yield e.onWillDismiss(),n.lastKnownQRData=null})()}openDeviceModal(){var n=this;return(0,l.Z)(function*(){const e=yield n.modalCtrl.create({component:Z,componentProps:{devices:yield n.getDevices()}});e.present();const{data:o}=yield e.onWillDismiss();n.startCamera(o?.deviceId)})()}ngOnDestroy(){this.stopSubscriptions.next(!0)}static#t=this.\u0275fac=function(e){return new(e||s)};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-home"]],viewQuery:function(e,o){if(1&e&&(t.Gf(b,5),t.Gf(O,5)),2&e){let a;t.iGM(a=t.CRH())&&(o.video=a.first),t.iGM(a=t.CRH())&&(o.videoContainer=a.first)}},standalone:!0,features:[t._Bn([i.IN]),t.jDz],decls:6,vars:0,consts:[[1,"video-card"],["videoContainer",""],["autoPlay","true","playsInline","true","muted",""],["video",""],["content",""]],template:function(e,o){1&e&&(t.TgZ(0,"div",0,1),t._UZ(2,"video",2,3),t.qZA(),t._UZ(4,"ion-content",null,4))},dependencies:[i.W2],styles:[".video-card[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;overflow:hidden}.video-card[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute}#camera-button[_ngcontent-%COMP%]{position:fixed;top:1em;right:1em}"]})}return s})()}}]);