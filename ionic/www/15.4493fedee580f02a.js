"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[15],{6015:($,y,a)=>{a.r(y),a.d(y,{HistoryComponent:()=>O});var i=a(6242),f=a(6814),m=a(6455),l=a(5861),d=a(2014),g=a(5619),S=a(6973),x=a(305);function u(r,v){const e="object"==typeof v;return new Promise((s,t)=>{const o=new x.Hp({next:n=>{s(n),o.unsubscribe()},error:t,complete:()=>{e?s(v.defaultValue):t(new S.K)}});r.subscribe(o)})}let p=(()=>{class r{constructor(){this.storage=(0,i.f3M)(d.K),this._storage=null,this.hasStorage=new g.X(!1),this.list$=new g.X([]),this.selected=new g.X(null),this.initStorage()}initStorage(){var e=this;return(0,l.Z)(function*(){const s=yield e.storage.create();e._storage=s,e.hasStorage.next(!0)})()}getAll(e="machineHistory"){var s=this;return(0,l.Z)(function*(){yield u(s.hasStorage),s._storage?.get(e).then(t=>{t?s.list$.next(JSON.parse(t)):(s.list$.next([]),console.log("no data"))})})()}get(e,s="machineHistory"){var t=this;return(0,l.Z)(function*(){yield u(t.hasStorage),t._storage?.get(s).then(o=>{t.selected.next(o?JSON.parse(o).find(n=>n.id===e):null)})})()}add(e,s="machineHistory"){var t=this;return(0,l.Z)(function*(){yield u(t.hasStorage),t._storage?.get(s).then(function(){var o=(0,l.Z)(function*(n){if(n){const c=JSON.parse(n),h=Math.max(...c.map(H=>H.id),0);e.id=h+1,c.push(e),yield t._storage?.set(s,JSON.stringify(c)),t.list$.next(c)}else e.id=1,yield t._storage?.set(s,JSON.stringify([e])),t.list$.next([e])});return function(n){return o.apply(this,arguments)}}())})()}update(e,s="machineHistory"){var t=this;return(0,l.Z)(function*(){yield u(t.hasStorage),t._storage?.get(s).then(function(){var o=(0,l.Z)(function*(n){if(n){const c=JSON.parse(n).map(h=>h.id===e.id?e:h);yield t._storage?.set(s,JSON.stringify(c)),t.list$.next(c)}});return function(n){return o.apply(this,arguments)}}())})()}remove(e,s="machineHistory"){var t=this;return(0,l.Z)(function*(){yield u(t.hasStorage),t._storage?.get(s).then(function(){var o=(0,l.Z)(function*(n){if(n){const c=JSON.parse(n).filter(h=>h.id!==e);yield t._storage?.set(s,JSON.stringify(c)),t.list$.next(c)}});return function(n){return o.apply(this,arguments)}}())})()}static#t=this.\u0275fac=function(s){return new(s||r)};static#s=this.\u0275prov=i.Yz7({token:r,factory:r.\u0275fac})}return r})();class Z{constructor(){this.id=0,this.location="",this.device="",this.user="",this.time="",this.arrived="",this.values={}}}let O=(()=>{class r{constructor(){this.historyService=(0,i.f3M)(p),this.list$=this.historyService.list$}ngOnInit(){this.historyService.getAll(),this.historyService.add(new Z)}static#t=this.\u0275fac=function(s){return new(s||r)};static#s=this.\u0275cmp=i.Xpm({type:r,selectors:[["app-history"]],standalone:!0,features:[i._Bn([p]),i.jDz],decls:4,vars:5,template:function(s,t){1&s&&(i.TgZ(0,"pre"),i._uU(1),i.ALo(2,"json"),i.ALo(3,"async"),i.qZA()),2&s&&(i.xp6(1),i.hij("  ",i.lcZ(2,1,i.lcZ(3,3,t.list$)),"\n"))},dependencies:[m.Fw,f.ez,f.Ov,f.Ts]})}return r})()}}]);